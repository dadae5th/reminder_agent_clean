name: Test Reminder (Every 10 minutes)

on:
  schedule:
    # 10ë¶„ë§ˆë‹¤ ì‹¤í–‰ (í…ŒìŠ¤íŠ¸ìš©)
    - cron: '*/10 * * * *'
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰

jobs:
  test-reminder:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Set up Python
      uses: actions/setup-python@v3
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Create test config
      run: |
        cat > config.yaml << EOF
        base_url: http://localhost:8001/complete
        dashboard_url: http://localhost:8001/dashboard
        smtp:
          host: smtp.gmail.com
          port: 465
          user: dadae5th@gmail.com
          pass: kptwwtdbavjgajly
          sender_name: í•´ì•¼í• ì¼ ì•Œë¦¼ (í…ŒìŠ¤íŠ¸)
          sender_email: dadae5th@gmail.com
        secret: gBckLh5s3CSP5VIu6TPi0f1aic6tofQ9EFgrcwf24W1Zl4B2
        EOF
        
    - name: Test email sending
      run: |
        python -c "
        from digest import run_daily_digest
        from datetime import datetime
        import traceback
        
        print(f'ðŸ• í…ŒìŠ¤íŠ¸ ì‹œê°„: {datetime.now()}')
        print('ðŸ“§ í…ŒìŠ¤íŠ¸ ë©”ì¼ ë°œì†¡ ì‹œìž‘...')
        
        try:
            run_daily_digest()
            print('âœ… í…ŒìŠ¤íŠ¸ ë©”ì¼ ë°œì†¡ ì™„ë£Œ!')
        except Exception as e:
            print(f'âŒ í…ŒìŠ¤íŠ¸ ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: {e}')
            traceback.print_exc()
        "
