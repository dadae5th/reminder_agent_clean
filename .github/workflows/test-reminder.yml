name: Test Reminder (Every 10 minutes)

on:
  schedule:
    # 10분마다 실행 (테스트용)
    - cron: '*/10 * * * *'
  workflow_dispatch:  # 수동 실행

jobs:
  test-reminder:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Set up Python
      uses: actions/setup-python@v3
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Create test config
      run: |
        cat > config.yaml << EOF
        base_url: http://localhost:8001/complete
        dashboard_url: http://localhost:8001/dashboard
        smtp:
          host: smtp.gmail.com
          port: 465
          user: dadae5th@gmail.com
          pass: kptwwtdbavjgajly
          sender_name: 해야할일 알림 (테스트)
          sender_email: dadae5th@gmail.com
        secret: gBckLh5s3CSP5VIu6TPi0f1aic6tofQ9EFgrcwf24W1Zl4B2
        EOF
        
    - name: Test email sending
      run: |
        python -c "
        from digest import run_daily_digest
        from datetime import datetime
        import traceback
        
        print(f'🕐 테스트 시간: {datetime.now()}')
        print('📧 테스트 메일 발송 시작...')
        
        try:
            run_daily_digest()
            print('✅ 테스트 메일 발송 완료!')
        except Exception as e:
            print(f'❌ 테스트 메일 발송 실패: {e}')
            traceback.print_exc()
        "
