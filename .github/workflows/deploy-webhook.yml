name: Deploy Webhook Server to Railway (DISABLED)

# Railway ë°°í¬ ë¹„í™œì„±í™” - GitHub Codespaces ì‚¬ìš© ì¤‘
on:
  # push:
  #   branches: [ main, automation-system ]
  #   paths:
  #     - 'webhook.py'
  #     - 'requirements.txt'
  #     - 'railway.json'
  #     - 'Dockerfile'
  #     - '.github/workflows/deploy-webhook.yml'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ë§Œ ê°€ëŠ¥

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: Install Railway CLI
      run: |
        curl -fsSL https://railway.app/install.sh | sh
        
    - name: Deploy to Railway
      env:
        RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
      run: |
        # Railway ë¡œê·¸ì¸ (ìƒˆë¡œìš´ ë°©ì‹)
        echo "$RAILWAY_TOKEN" | railway auth:login
        
        # í”„ë¡œì íŠ¸ì— ì—°ê²° (ê¸°ì¡´ í”„ë¡œì íŠ¸ê°€ ìˆìœ¼ë©´ ì—°ê²°, ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±)
        railway link --project reminder-webhook || railway new reminder-webhook
        
        # í™˜ê²½ë³€ìˆ˜ ì„¤ì •
        railway variables set SUPABASE_URL="${{ secrets.SUPABASE_URL }}"
        railway variables set SUPABASE_KEY="${{ secrets.SUPABASE_KEY }}"
        railway variables set SUPABASE_SERVICE_KEY="${{ secrets.SUPABASE_SERVICE_KEY }}"
        railway variables set SMTP_HOST="${{ secrets.SMTP_HOST }}"
        railway variables set SMTP_PORT="${{ secrets.SMTP_PORT }}"
        railway variables set SMTP_USER="${{ secrets.SMTP_USER }}"
        railway variables set SMTP_PASS="${{ secrets.SMTP_PASS }}"
        railway variables set SMTP_SENDER_NAME="${{ secrets.SMTP_SENDER_NAME }}"
        railway variables set SMTP_SENDER_EMAIL="${{ secrets.SMTP_SENDER_EMAIL }}"
        railway variables set BASE_URL="${{ secrets.BASE_URL }}"
        railway variables set DASHBOARD_URL="${{ secrets.DASHBOARD_URL }}"
        railway variables set SECRET="${{ secrets.SECRET }}"
        railway variables set ENVIRONMENT="production"
        
        # ë°°í¬
        railway deploy
        
    - name: Get deployment URL
      env:
        RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
      run: |
        echo "$RAILWAY_TOKEN" | railway auth:login
        railway status
        echo "ğŸš€ Webhook server deployed successfully!"
        echo "Check your Railway dashboard for the deployment URL"
